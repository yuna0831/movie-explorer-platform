<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Moovy – Review Lounge</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #0d0d0d;
      font-family: 'DM Sans', sans-serif;
      color: #f3f3f3;
    }

    header {
      text-align: center;
      padding: 40px 20px 20px;
    }

    header h1 {
      font-size: 36px;
      font-weight: 700;
      color: #f97316;
      margin: 0;
    }
    header h1 i {
      color: #f97316;
      margin-right: 10px;
    }

    header p {
      font-size: 16px;
      color: #aaa;
      margin-top: 5px;
    }

    #movieInfo {
      text-align: center;
      margin: 30px auto;
    }

    #movieInfo img {
      margin-top: 15px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.08);
      max-width: 200px;
    }

    #commentSection, #commentsContainer {
      max-width: 700px;
      margin: 30px auto;
      background-color: #1a1a1a;
      padding: 24px;
      border-radius: 12px;
    }

    textarea, select {
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      font-size: 15px;
      background-color: #2a2a2a;
      color: white;
      border-radius: 8px;
      border: none;
    }

    .comment-box {
      background-color: #2a2a2a;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .comment-box .rating {
      color: #facc15;
      font-size: 14px;
    }

    .comment-box .username {
      font-weight: 500;
      color: #f97316;
      font-size: 14px;
    }

    .comment-box .content {
      margin-top: 8px;
      font-size: 15px;
      line-height: 1.5;
    }

    .submit-btn {
      margin-top: 14px;
      background-color: #22c55e;
    }

    .submit-btn:hover {
      background-color: #4ade80;
    }

    .reply-input {
      margin-top: 14px;
      padding: 12px;
      background-color: #262626;
      border-left: 3px solid #f97316;
      border-radius: 8px;
      animation: fadeIn 0.3s ease-in-out;
    }

    .reply-input textarea {
      width: 100%;
      background-color: #1e1e1e;
      color: white;
      border-radius: 6px;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #444;
      margin-bottom: 8px;
    }

    .reply-input button {
      background-color: #3b82f6;
      border: none;
      padding: 8px 16px;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s ease;
    }

    .reply-input button:hover {
      background-color: #60a5fa;
    }

    .comment-form-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .comment-form-group textarea,
    .comment-form-group select,
    .comment-form-group button {
      width: 100%;
      box-sizing: border-box;
      margin: 0;
    }

    .search-box {
      margin-top: 30px;
    }

    input#movieTitle {
      padding: 14px 20px;
      width: 60%;
      max-width: 500px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #1e1e1e;
      color: white;
    }

    button {
      padding: 12px 24px;
      background-color: #f97316;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      margin-left: 10px;
      cursor: pointer;
    }

    button:hover {
      background-color: #fb923c;
    }

    .search-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 20px 20px 40px;
  animation: fadeIn 0.7s ease-in-out;
}

.search-title {
  font-size: 28px;
  font-weight: 600;
  color: #f3f3f3;
  margin-bottom: 20px;
}

.search-glass {
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
  width: 90%;
  max-width: 600px;
  padding: 0;
  background: none;
  box-shadow: none;
  backdrop-filter: none;
}

.search-glass input#movieTitle {
  padding: 14px 18px;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #444;
  background-color: rgba(30, 30, 30, 0.85);
  color: #f3f3f3;
  flex: 1;
  min-width: 250px;
  outline: none;
  transition: border 0.3s ease;
}

.search-glass input#movieTitle:focus {
  border-color: #f97316;
}

.search-glass button {
  padding: 14px 20px;
  font-size: 15px;
  border-radius: 10px;
  border: none;
  background: linear-gradient(135deg, #f97316, #fb923c);
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.3s ease;
}

.search-glass button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
}

.emotion-buttons {
  margin-top: 15px;
  text-align: center;
}

.emotion-options {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin-top: 10px;
}

.emotion-btn {
  padding: 8px 16px;
  font-size: 14px;
  border: 1px solid #555;
  background-color: #1e1e1e;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.emotion-btn:hover {
  background-color: #f97316;
  border-color: #f97316;
}

.emotion-btn.selected {
  background-color: #f97316;
  border-color: #f97316;
}

.emotion-tag {
  display: inline-block;
  background-color: #333;
  color: #fff;
  padding: 4px 8px;
  margin: 2px 4px 2px 0;
  border-radius: 16px;
  font-size: 13px;
}


    

    

 

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media screen and (max-width: 600px) {
      input#movieTitle {
        width: 80%;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-film"></i> Moovy: Review Lounge</h1>
    <p>Leave your thoughts and ratings for movies you love (or hate!)</p>
  </header>
  <div class="search-box">
    
    <div class="search-glass">
      <input id="movieTitle" placeholder="Search movie by title..." />
      <button onclick="searchAndRedirect()">
        <i class="fas fa-search"></i> Search
      </button>
    </div>
  </div>
  


  <div id="movieInfo"></div>


  <div id="commentSection" style="display: none;">
    <div class="comment-form-group">
      <textarea id="commentInput" rows="4" placeholder="Write your thoughts here..."></textarea>
      
      
      <select id="ratingSelect">
        <option value="">Rate the movie</option>
        <option value="5">&#9733;&#9733;&#9733;&#9733;&#9733; (5)</option>
        <option value="4">&#9733;&#9733;&#9733;&#9733; (4)</option>
        <option value="3">&#9733;&#9733;&#9733; (3)</option>
        <option value="2">&#9733;&#9733; (2)</option>
        <option value="1">&#9733; (1)</option>
      </select>
      <div class="emotion-buttons">
        <span>How did this movie make you feel?</span>
        <div class="emotion-options">
          <button class="emotion-btn" data-emotion="Comforted">
            <i class="fa-solid fa-heart"></i> Comforted
          </button>
          <button class="emotion-btn" data-emotion="Shocked">
            <i class="fa-solid fa-bolt"></i> Shocked
          </button>
          <button class="emotion-btn" data-emotion="Peaceful">
            <i class="fa-solid fa-leaf"></i> Peaceful
          </button>
          <button class="emotion-btn" data-emotion="Amused">
            <i class="fa-solid fa-face-laugh"></i> Amused
          </button>
          <button class="emotion-btn" data-emotion="Fluttered">
            <i class="fa-solid fa-heart-circle-bolt"></i> Fluttered
          </button>
          <button class="emotion-btn" data-emotion="Tense">
            <i class="fa-solid fa-triangle-exclamation"></i> Tense
          </button>
        </div>
      </div>
      
      <input type="hidden" id="selectedEmotions" />
      
      <button class="submit-btn" onclick="submitComment()">
        <i class="fas fa-paper-plane"></i> Submit Review
      </button>
    </div>
  </div>
  <div id="commentsContainer"></div>
  <script src="comment.js"></script>
  <script>
    // Load movie info on page load using URL parameter
    window.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const movieId = urlParams.get('movieId');
      if (!movieId) return alert("No movieId provided.");
      localStorage.setItem("currentMovieId", movieId);
      fetch(`/api/movie/${movieId}`)
        .then(res => res.json())
        .then(movie => {
          document.getElementById("movieInfo").innerHTML = `
            <h3>${movie.title} (${movie.release_date?.split("-")[0] || "N/A"})</h3>
            <img src="https://image.tmdb.org/t/p/w200${movie.poster_path}" />
          `;
          document.getElementById("commentSection").style.display = "block"; 
          fetchComments(movieId);
        });
    });
  </script>
  <script>
    // 감정 버튼 선택 처리
    document.addEventListener("DOMContentLoaded", () => {
    const emotionButtons = document.querySelectorAll(".emotion-btn");
    const emotionInput = document.getElementById("selectedEmotions");  // ID 변경 주의

    emotionButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        // 선택 토글
        btn.classList.toggle("selected");

        // 선택된 감정들을 모두 수집해서 hidden input에 저장
        const selectedEmotions = Array.from(document.querySelectorAll(".emotion-btn.selected"))
          .map(b => b.dataset.emotion);

        emotionInput.value = selectedEmotions.join(",");
      });
    });
  });
  </script>
  
  <script>
    async function searchAndRedirect() {
      const title = document.getElementById("movieTitle").value.trim();
      if (!title) return alert("Please enter a movie title");

      const res = await fetch(`/api/search?query=${encodeURIComponent(title)}`);
      const data = await res.json();

      if (data.results.length === 0) {
        alert("No movie found");
        return;
      }

      const movie = data.results[0];
      const movieId = movie.id;

      // 검색된 영화 id를 기반으로 댓글 페이지로 이동
      localStorage.setItem("currentMovieId", movieId);
      window.location.href = `/movie-comment.html?movieId=${movieId}`;
    }

  </script>
</body>
</html>
